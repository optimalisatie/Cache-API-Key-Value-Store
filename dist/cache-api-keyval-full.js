(function(h){function l(c){c&&(a.CacheApiDB=c);for(c=k.shift();c;)c()}var a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,k=[];a.onCacheApiDB=function(c){a.CacheApiDB?c():k.push(c)};a.CacheApiDBFallback||(a.CacheApiDBFallback=function(){var c=this;c.no=1;["get","set","del","prune"].forEach(function(a){c[a]=function(){return Promise.reject("No Cache API")}})});"caches"in a&&caches instanceof CacheStorage?(a.CacheApiDB=h(),caches.open("x")["catch"](function(c){"SecurityError"!=
c.name&&console&&console.error("Cache API: "+c.message);l(a.CacheApiDBFallback)}).then(function(){l()})):(console&&console.error("No Cache API"),a.CacheApiDB=a.CacheApiDBFallback)})(function(){function h(d,b){return caches.open(d).then(b)}function l(d,b){return h(d,function(f){m(b)&&n();var e=new Request((b||"").toString());return f.match(e).then(function(b){return!b||k(d,e,b)?!1:b.json()})})}function a(d,b,f,e){return h(d,function(d){(m(b)||m(f))&&n();var c=new Request((b||"").toString()),a={"Content-Type":"application/json"};
f=JSON.stringify(f);e&&(a["x-d"]=Math.round(Date.now()/1E3),e=parseInt(e),(isNaN(e)||0>e)&&n(),a["x-e"]=e.toString());a=new Response(f,{headers:a});return d.put(c,a)})}function k(d,b,a){var e=a.headers.get("x-e");a=a.headers.get("x-d");if(e&&a&&(e=parseInt(e),a=parseInt(a),a+e<Math.round(Date.now()/1E3)))return c(d,b,1),!0}function c(d,b,a){return h(d,function(d){m(b)&&n();b=a?b:new Request((b||"").toString());return d["delete"](b)})}function q(d){return h(d,function(b){return b.keys().then(function(a){var c=
[];a.forEach(function(a){c.push(b.match(a))});return Promise.all(c).then(function(a){a.forEach(function(a,b){k(d,b,a)})})})})}function g(a,b){if(this instanceof g)this.a=a,"object"===typeof b&&b.namespace&&(this.b=b.namespace);else return new g(a,b)}function p(a,b){return(a?a+":":"")+b}function m(a){return"undefined"===typeof a}function n(){throw Error("input");}g.prototype.get=function(a){return l(this.a,p(this.b,a))};g.prototype.set=function(c,b,f){return a(this.a,p(this.b,c),b,f)};g.prototype.del=
function(a){return c(this.a,p(this.b,a))};g.prototype.prune=function(){return q(this.a)};return g});
