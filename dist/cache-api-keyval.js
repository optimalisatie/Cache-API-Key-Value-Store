(function(h){function l(d){d&&(c.CacheApiDB=d);for(d=k.shift();d;)d()}var c="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,k=[];c.onCacheApiDB=function(d){c.CacheApiDB?d():k.push(d)};c.b||(c.b=function(){var d=this;d.no=1;["get","set","del","prune"].forEach(function(c){d[c]=function(){return Promise.reject("No Cache API")}})});caches instanceof CacheStorage?(c.CacheApiDB=h(),caches.open("x")["catch"](function(d){"SecurityError"!=d.name&&console&&
console.error("Cache API: "+d.message);l(c.b)}).then(function(){l()})):(console&&console.error("No Cache API"),c.CacheApiDB=c.b)})(function(){function h(b,a){return caches.open(b).then(a)}function l(b,a){return h(b,function(e){m(a)&&n();var f=new Request((a||"").toString());return e.match(f).then(function(a){return!a||k(b,f,a)?!1:a.json()})})}function c(b,a,e,f){return h(b,function(b){(m(a)||m(e))&&n();var d=new Request((a||"").toString()),c={"Content-Type":"application/json"};e=JSON.stringify(e);
f&&(c["x-d"]=Math.round(Date.now()/1E3),f=parseInt(f),(isNaN(f)||0>f)&&n(),c["x-e"]=f.toString());c=new Response(e,{headers:c});return b.put(d,c)})}function k(b,a,e){var c=e.headers.get("x-e");e=e.headers.get("x-d");if(c&&e&&(c=parseInt(c),e=parseInt(e),e+c<Math.round(Date.now()/1E3)))return d(b,a,1),!0}function d(b,a,c){return h(b,function(b){m(a)&&n();a=c?a:new Request((a||"").toString());return b["delete"](a)})}function q(b){return h(b,function(a){return a.keys().then(function(c){var d=[];c.forEach(function(b){d.push(a.match(b))});
return Promise.all(d).then(function(a){a.forEach(function(a,c){k(b,c,a)})})})})}function g(b,a){if(this instanceof g)this.a=b,"object"===typeof a&&a.namespace&&(this.c=a.namespace);else return new g(b,a)}function p(b,a){return(b?b+":":"")+a}function m(b){return"undefined"===typeof b}function n(){throw Error("input");}g.prototype.get=function(b){return l(this.a,p(this.c,b))};g.prototype.set=function(b,a,d){return c(this.a,p(this.c,b),a,d)};g.prototype.del=function(b){return d(this.a,p(this.c,b))};
g.prototype.prune=function(){return q(this.a)};return g});
